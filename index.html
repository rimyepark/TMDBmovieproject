<!DOCTYPE html>
<html>

<head>
    <title>Movie List</title>
    <style>
        header {
            height: 50px;
            padding: 1rem;
            display: flex;
            justify-content: flex-end;
            background-color: palevioletred;

        }



        input {
            height: 20px;
            background-color: transparent;
            border: 2px solid white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 1rem;
            color: #fff;
            font-size: 1rem;
        }

        input:focus {
            outline: 0;
            background-color: pink;
        }

        input::placeholder {
            color: white;

        }

        .movie-card {
            width: 300px;
            background-color: white;
            display: inline-block;
            width: 300px;
            margin: 10px;
            padding: 10px;
            border: 1px solid palevioletred;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0.2px 4px 5px rgba(0, 0, 0, 0.1);
        }

        .movie-card img {
            width: 100%;
            height: auto;
        }

        main {
            background-color: antiquewhite;
        }

        h1 {

            color: beige;
            justify-content: center;
            display: grid;
        }
    </style>
</head>

<body>

    <header>
        <p></p>
        <input type="text" id="search-input" placeholder="Search movie...">
    </header>

    <main>
        <div id="movie-container"></div>
    </main>

    <script>



        // const options 객체는 API 요청에 필요한 설정을 정의한다. 
        // 여기서는 GET 메서드를 사용하고, 헤더에는 JSON 응답을 요청하며, 인증에 사용할 Bearer 토큰을사용했다.
        // API Key를 사용하고 싶었는데 키를 사용하면 계속 오류가 나서 결국 토큰을 사용했다.



        //         const apiKey = process.env.MY_API_TOKEN;
        // const options = {
        //   method: 'GET',
        //   headers: {
        //     accept: 'application/json',
        //     Authorization: `Bearer ${apiKey}`
        //   }
        // };

        // 제일 마지막으로는 윈도우 환경 변수까지 사용하려고 했다. dotenv 파일이 버전이 달라서
        // 적용이 안된다는 에러 메시지가 떠서 몇번을 지우고 깔다가 마지막에는 윈도우에서 HTML로
        //직접 적용하는 방법까지 썼다(권장하는 방법이 아님) 근데도 오류가 나서 결국 포기했다.
        
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJiYzMwNDU5MGVjY2EwMmM4ZGVlMWIyMjJkNzMzYjViZiIsInN1YiI6IjY0NzQ2NzJhZGQ3MzFiMmQ3NjJiZjc5NyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.irekIixQ9Yx-b9lIPtMCcWuI4JrQ-23AOJBFMtnY_PA'
            }
        };

        const searchInput = document.getElementById('search-input');
        const movieContainer = document.getElementById('movie-container');


        // fetchPopularMovies 함수는 fetch 함수를 사용하여 인기 영화 목록을 가져오는 API 요청을 보낸다.
        // fetch 함수는 응답을 받으면 JSON 형식으로 변환하여 다음 처리 단계로 넘긴다.

        function fetchPopularMovies() {
            fetch('https://api.themoviedb.org/3/movie/popular?language=en-US&page=1', options)
                .then(response => response.json())
                .then(data => {
                    displayMovies(data.results);
                })
                .catch(err => console.error(err));
        }


        //displayMovies 함수 내부에서 사용되는 반복문이다.
        //  movies라는 배열을 순회하면서 웹페이지에 추가한다.

        function displayMovies(movies) {
            movieContainer.innerHTML = '';


            // div 요소를 생성하여 영화 카드를 나타냈다. 위에서 만들던 카드위로 출력이 되지 않아
            //여기서 만들었다. 
            movies.forEach(movie => {
                const card = document.createElement('div');
                card.classList.add('movie-card');

                const title = document.createElement('h2');
                title.textContent = movie.title;

                const poster = document.createElement('img');
                poster.src = 'https://image.tmdb.org/t/p/w500' + movie.poster_path;

                const overview = document.createElement('p');
                overview.textContent = movie.overview;

                const voteAverage = document.createElement('p');
                voteAverage.textContent = 'Vote Average: ' + movie.vote_average;
                //각 요소를 card 요소의 자식 요소로 추가.
                card.appendChild(title);
                card.appendChild(poster);
                card.appendChild(overview);
                card.appendChild(voteAverage);

                //클릭할때 경고창이 뜨게 만들었다.
                card.addEventListener('click', () => {
                    alert('Movie ID: ' + movie.id);
                });

                movieContainer.appendChild(card);
            });
        }

        // filterMovies 함수는 검색어를 기반으로 영화 목록을 거른다.
        // popularMovies 배열에서 title 속성을 검색어와 비교하여 포함되는 영화를 찾게했다.
        // 일치하는 영화만을 담은 배열을 만들고, displayMovies 함수를 호출하여 결과를 웹 페이지에 표시.
        //근데 사실 이부분은 정말 몰라서 그냥 영어권 유투브를 보면서 따라했다. 외국어로 된 40분짜리 영상을
        //4시간동안 해석하고 들으면서 했다. 사실 정확한 뜻은 잘 모르겠다. 
        function filterMovies(searchTerm) {
            const filteredMovies = popularMovies.filter(movie => {
                const title = movie.title.toLowerCase();
                return title.includes(searchTerm.toLowerCase());
            });

            displayMovies(filteredMovies);
        }

        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.trim();
            filterMovies(searchTerm);
        });

        fetchPopularMovies();
    </script>
</body>

</html>